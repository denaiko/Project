var user={};var userIsUsed=2;var fontsize,username,userlevel,userhp,usermaxhp,userhpbar,userxp,usermaxxp,usergold,useravatar,useratt,userdef,level,monsterxp;function loginCreate(){var a=new XMLHttpRequest();a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){$("#login").append(a.responseText)}$("#loginFrame svg").height(fontsize*2)};a.open("POST","login.html",true);a.send()}function loginToCreate(){$("#load").css("z-index","10000");var a=new XMLHttpRequest();a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){$("#login").append(a.responseText)}$("#loginFrame").hide();$("#createUser svg").height(fontsize*2)};a.open("POST","create.html",true);a.send();$("#load").css("z-index","0");$("#loginUsername").val("");$("#loginPassword").val("")}function create(){var a;var b=$("#createUsername").val().toLowerCase();var c=$("#createPassword").val();$.getJSON("js/users.json",{format:"json"}).done(function(e){user=e;var d=0;userIsUsed=0;$.each(user,function(f,g){d++;a=user[f].name.toLowerCase();if(b===a){userIsUsed++}});if(userIsUsed>0){alert("This username has already been taken \n \n Please use another username")}if(userIsUsed==0){array={name:b,pass:c,level:1,hp:100,xp:0,gold:0,avatar:"swordsman"};user.push(array);$.ajax({type:"POST",url:"json.php",data:{users:user}});$("#createUser").remove();$("#loginFrame").show();alert("User has been created")}})}function removeCreate(){$("#load").css("z-index","10000");$("#createUser").remove();$("#loginFrame").show();$("#load").css("z-index","0")}function removeBattle(a){$("#load").css("z-index","10000");$("#Battle").remove();$("#load").css("z-index","0");userxp+=a;$("#mapStatusXp").text("XP "+userxp+" / "+usermaxxp)}function battleCreate(c,b){c=this.level;monsterxp=c*10;var a=new XMLHttpRequest();a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){$("#game").append(a.responseText);$("#enemyBattleName").text(c);$("#playerBattleName").text(user[b].name);$("#attack").on("click",function(){removeBattle(monsterxp);user[b].xp=parseInt(user[b].xp)+parseInt(monsterxp);user[b].gold=parseInt(user[b].gold)+parseInt(monsterxp);if(user[b].xp>Math.ceil(Math.pow(3,(user[b].level-1)/7)*100)){user[b].xp-=Math.ceil(Math.pow(3,(user[b].level-1)/7)*100);user[b].level=parseInt(user[b].level)+1;usermaxxp=Math.ceil(Math.pow(3,(user[b].level-1)/7)*100);user[b].att=Math.floor(Math.pow(1.07,user[b].level-1)*10);user[b].def=Math.floor(Math.pow(1.06,user[b].level-1)*10);$("#mapStatusXp").text("XP "+user[b].xp+" / "+usermaxxp);$("#mapStatusLevel").text("Level "+user[b].level);$("#mapStatusAtt").text("Level "+user[b].att);$("#mapStatusDef").text("Level "+user[b].def)}$("#mapStatusGold").text("Gold "+user[b].gold);$.ajax({type:"POST",url:"json.php",data:{users:user}})})}};a.open("POST","battle.html",true);a.send()}function mapCreate(b){var a=new XMLHttpRequest();a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){$("#game").append(a.responseText);username=user[b].name;userlevel=parseInt(user[b].level);userhp=Math.floor(Math.pow(1.05,userlevel-1)*100);usermaxhp=userhp;userhpbar=(userhp/usermaxhp)*100;userxp=parseInt(user[b].xp);usermaxxp=Math.ceil(Math.pow(3,(userlevel-1)/7)*100);usergold=parseInt(user[b].gold);useravatar=user[b].avatar;useratt=Math.floor(Math.pow(1.07,userlevel-1)*10);userdef=Math.floor(Math.pow(1.06,userlevel-1)*10);$("#mapStatusName").text(username);$("#mapStatusLevel").text("Level "+userlevel);$("#mapStatusHp").text("HP "+userhp+" / "+usermaxhp);$("#mapStatusXp").text("XP "+userxp+" / "+usermaxxp);$("#mapStatusGold").text("Gold "+usergold);$("#mapStatusAvatar").attr("src","img/"+useravatar+".png");$("#mapStatusAtt").text("Att "+useratt);$("#mapStatusDef").text("Def "+userdef);$("button[id*='level']").click(function(){level=this.id.replace("level","");battleCreate(level,b)})}};a.open("POST","map.html",true);a.send()}function aspect(){var c,a,d,b;c=$(window).width()-4;a=$(window).height()-4;if(c/a<16/9){b=c*9/16;d=(a-b)/2;$("#game").css("margin-left","0");$("#game").css("margin-top",d);$("#game").width(c);$("#game").height(b);fontsize=(b-4)/15;$("body").css("font-size",fontsize);$("body").css("line-height",fontsize);$("#loginFrame svg").height(fontsize*2);$("#createUser svg").height(fontsize*2)}else{if(c/a>16/9){b=a*16/9;d=(c-b)/2;$("#game").css("margin-left",d);$("#game").css("margin-top","0");$("#game").width(b);$("#game").height(a);fontsize=(a-4)/15;$("body").css("font-size",fontsize);$("body").css("line-height",fontsize);$("#loginFrame svg").height(fontsize*2);$("#createUser svg").height(fontsize*2)}else{if(c/a===16/9){$("#game").css("margin-left","0");$("#game").css("margin-top","0");$("#game").width(c);$("#game").height(a);fontsize=(a-4)/15;$("body").css("font-size",fontsize);$("body").css("line-height",fontsize);$("#loginFrame svg").height(fontsize*2);$("#createUser svg").height(fontsize*2)}}}}function login(){var b,a,d,c;var e=0;$.getJSON("js/users.json",{format:"json"}).done(function(f){user=f;b=$("#loginUsername").val().toLowerCase();d=$("#loginPassword").val();for(i=0;i<user.length;i++){a=user[i].name.toLowerCase();c=user[i].pass;if(b===a){if(d===c){$("#login").hide();mapCreate(i);e++}}}if(e==0){alert("Username/Password not correct")}})}function logout(){$.ajax({type:"POST",url:"json.php",data:{users:user}}).done(function(){$("#map").remove();$("#login").css("display","block")})}$(document).ready(function(){$("#playerBattle").load()});$(window).on("load",function(){aspect();loginCreate()});$(window).on("resize",function(){aspect()});